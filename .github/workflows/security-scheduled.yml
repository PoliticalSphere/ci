# ==============================================================================
# Political Sphere â€” Security Scheduled (Caller)
# ==============================================================================
# Wrapper workflow that delegates to the reusable job definition.
# ==============================================================================

name: Security Scheduled

on:
  workflow_call:
    inputs:
      runner:
        description: "Runner label"
        type: string
        required: false
        default: "ubuntu-22.04"
      node_version:
        description: "Node.js major version"
        type: string
        required: false
        default: "22"
      fetch_depth:
        description: "Git fetch depth (1 = shallow, 0 = full history)"
        type: number
        required: false
        default: 1
      cache:
        description: "Enable dependency caching (1 = on, 0 = off)"
        type: string
        required: false
        default: "1"
      platform_ref:
        description: "Platform repository ref"
        type: string
        required: false
        default: "f6eac5049f626a672c84f3899f0572a87af07ca1"

      platform_require_pinned_ref:
        description: "Require platform_ref to be a full 40-char commit SHA (true|false)"
        type: string
        required: false
        default: "true"

      semgrep_version:
        description: "Pinned Semgrep version to install"
        type: string
        required: false
        default: "1.146.0"

      semgrep_sha256:
        description: "SHA-256 checksum for the Semgrep package artifact"
        type: string
        required: false
        default: "a8eaae8191c3dd5b85c7b40cfaeca6db623fe387c85f8938176d112855cca829"

      semgrep_allow_unverified:
        description: "Allow Semgrep install without checksum (true|false)"
        type: string
        required: false
        default: "false"
      codeql_languages:
        description: "CodeQL languages (comma-separated)"
        type: string
        required: false
        default: "javascript"

  workflow_dispatch:

  schedule:
    - cron: "0 3 * * 0"  # Weekly, Sunday 03:00 UTC

# ==============================================================================
# DEFAULT PERMISSIONS
# ==============================================================================

jobs:
  call:
    name: Security Scheduled
    uses: ./.github/workflows/_reusable-security-scheduled.yml
    permissions:
      contents: read
      security-events: write
    with:
      runner: ${{ inputs.runner || 'ubuntu-22.04' }}
      node_version: ${{ inputs.node_version || '22' }}
      fetch_depth: ${{ inputs.fetch_depth || 1 }}
      cache: ${{ inputs.cache || '1' }}
      platform_ref: ${{ inputs.platform_ref || 'f6eac5049f626a672c84f3899f0572a87af07ca1' }}
      platform_require_pinned_ref: ${{ inputs.platform_require_pinned_ref || 'true' }}
      semgrep_version: ${{ inputs.semgrep_version || '1.146.0' }}
      semgrep_sha256: ${{ inputs.semgrep_sha256 || 'a8eaae8191c3dd5b85c7b40cfaeca6db623fe387c85f8938176d112855cca829' }}
      semgrep_allow_unverified: ${{ inputs.semgrep_allow_unverified || 'false' }}
      codeql_languages: ${{ inputs.codeql_languages || 'javascript' }}
