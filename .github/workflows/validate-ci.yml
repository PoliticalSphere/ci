# ==============================================================================
# Political Sphere â€” Validate CI (Caller)
# ==============================================================================
# Wrapper workflow that delegates to the reusable job definition.
# ============================================================================== 

name: Validate CI

on:
  workflow_call:
    inputs:
      runner:
        description: "Runner label"
        type: string
        required: false
        default: "ubuntu-22.04"
      node_version:
        description: "Node.js major version"
        type: string
        required: false
        default: "22"
      fetch_depth:
        description: "Git fetch depth (1 = shallow, 0 = full history)"
        type: number
        required: false
        default: 1
      cache:
        description: "Enable dependency caching (1 = on, 0 = off)"
        type: string
        required: false
        default: "1"
      validate_timeout_minutes:
        description: "Timeout for Validate-CI job in minutes"
        type: number
        required: false
        default: 10
      checkout_ref:
        description: "Optional git ref to validate (branch, tag, or SHA)"
        type: string
        required: false
        default: ""
      platform_ref:
        description: "Platform repo ref to checkout for shared scripts/configs"
        type: string
        required: false
        default: "f6eac5049f626a672c84f3899f0572a87af07ca1"
      platform_require_pinned_ref:
        description: "Require platform_ref to be a full 40-char commit SHA (true|false)"
        type: string
        required: false
        default: "true"
      install_dependencies:
        description: "Install dependencies in the target repo (1 = on, 0 = off)"
        type: string
        required: false
        default: "0"
      install_platform_dependencies:
        description: "Install dependencies in the platform repo (1 = on, 0 = off)"
        type: string
        required: false
        default: "1"
      verify_remote_shas:
        description: "Verify action SHAs against upstream remotes (1 = on, 0 = off)"
        type: string
        required: false
        default: "1"
      pr_only:
        description: "Validate only workflows/actions changed in the PR (1 = on, 0 = off)"
        type: string
        required: false
        default: "0"
      pr_base_ref:
        description: "PR base SHA for diff-based validation"
        type: string
        required: false
        default: ""
      pr_head_ref:
        description: "PR head SHA for diff-based validation"
        type: string
        required: false
        default: ""
      artifact_name:
        description: "Artifact name for validate-ci outputs"
        type: string
        required: false
        default: "validate-ci"
      retention_days:
        description: "Artifact retention in days"
        type: number
        required: false
        default: 7
    secrets:
      NODE_AUTH_TOKEN:
        description: "Optional token for private registry installs"
        required: false

jobs:
  call:
    name: Validate CI
    uses: ./.github/workflows/_reusable-validate-ci.yml
    with:
      runner: ${{ inputs.runner }}
      node_version: ${{ inputs.node_version }}
      fetch_depth: ${{ inputs.fetch_depth }}
      cache: ${{ inputs.cache }}
      validate_timeout_minutes: ${{ inputs.validate_timeout_minutes }}
      checkout_ref: ${{ inputs.checkout_ref }}
      platform_ref: ${{ inputs.platform_ref }}
      platform_require_pinned_ref: ${{ inputs.platform_require_pinned_ref }}
      install_dependencies: ${{ inputs.install_dependencies }}
      install_platform_dependencies: ${{ inputs.install_platform_dependencies }}
      verify_remote_shas: ${{ inputs.verify_remote_shas }}
      pr_only: ${{ inputs.pr_only }}
      pr_base_ref: ${{ inputs.pr_base_ref }}
      pr_head_ref: ${{ inputs.pr_head_ref }}
      artifact_name: ${{ inputs.artifact_name }}
      retention_days: ${{ inputs.retention_days }}
    secrets:
      NODE_AUTH_TOKEN: ${{ secrets.NODE_AUTH_TOKEN }}
