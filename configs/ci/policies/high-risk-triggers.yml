# ==============================================================================
# Political Sphere â€” High-Risk Triggers Allowlist (GitHub Actions)
# ------------------------------------------------------------------------------
# Purpose:
#   Govern exceptions for workflow triggers that are higher risk and blocked by
#   default (e.g., pull_request_target, repository_dispatch, workflow_run).
#
# Policy:
#   - Default deny: validate-ci blocks high-risk triggers unless allowlisted here.
#   - Every allowlist entry MUST:
#       - be narrowly scoped (workflow_path + trigger)
#       - specify required safeguards (machine-checkable)
#       - reference a risk decision
#       - be time-bounded (review_by)
#   - This file is configuration only; logic lives in validate-ci.
# ==============================================================================

meta:
  version: 1.2.0
  owner: political-sphere
  classification: internal
  last_reviewed: 2025-12-19
  review_interval_days: 180

rule:
  # Explicitly block high-risk triggers unless allowlisted.
  disallow_by_default:
    - pull_request_target
    - repository_dispatch
    - workflow_run
    - issue_comment
  require_safe_checkout_ref: true

policy:
  default: deny

  # Governance
  require_risk_decision: true
  risk_decisions_file: docs/risk-decisions.md
  require_review_by: true
  fail_on_expired: true

  # Validator expectations for allowlisted workflows using high-risk triggers.
  # These can be enforced by validate-ci by inspecting workflow/job/step config.
  safeguards_schema:
    require_permissions: true
    forbid_checkout: true
    forbid_running_untrusted_code: true

# Triggers that validate-ci treats as high risk.
high_risk_triggers:
  - pull_request_target
  - workflow_run
  - repository_dispatch

# Empty by default. Add entries only with explicit approval.
#
# Example: An allowlist entry (approved via risk decision) specifies a
# trigger (e.g. pull_request_target), selector (workflow_path), a brief
# rationale, and the required safeguards (forbid_checkout,
# forbid_running_untrusted_code, require_permissions).
#
#     # Optional additional hardening expectations
#     require_concurrency: true
#     require_timeout_minutes_max: 10
#
#   risk_decision_id: RD-00X
#   approved_by: security
#   review_by: 2026-03-19
allowlist: []
