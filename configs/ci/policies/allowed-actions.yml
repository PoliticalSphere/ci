# ==============================================================================
# Political Sphere â€” Allowed GitHub Actions (Default Deny)
# ------------------------------------------------------------------------------
# Purpose:
#   Supply-chain control: define the only GitHub Actions repositories that may
#   be referenced by workflows (default deny).
#
# Non-negotiable rules:
#   - DEFAULT DENY: any external action not allowlisted here is forbidden.
#   - Adding or removing allowlisted actions requires a documented risk decision.
#
# Scope:
#   - This allowlists action publishers/repos (owner/name) only.
#   - Pinning and ref format are validated separately (and must always pass).
#   - Local action rules live in the local-actions policy.
#
# Governance:
#   - Entries MUST be unique by `repo`.
#   - Changes MUST reference a risk decision (see risk_decisions_file).
#   - Review cadence enforced via last_reviewed + review_interval_days.
# ==============================================================================

meta:
  version: 1.2.0
  owner: political-sphere
  classification: internal
  last_reviewed: 2025-12-19
  review_interval_days: 180

policy:
  default: deny

  change_control:
    require_risk_decision_for_changes: true
    risk_decisions_file: docs/risk-decisions.md

allowlist:
  # ---------------------------------------------------------------------------
  # GitHub-maintained actions (core CI primitives)
  # ---------------------------------------------------------------------------
  - repo: actions/checkout
    category: github-maintained
    purpose: Checkout repository code
    notes: Prefer minimal fetch-depth unless explicitly required

  - repo: actions/cache
    category: github-maintained
    purpose: Dependency and build caching

  - repo: actions/setup-node
    category: github-maintained
    purpose: Install and configure Node.js runtime

  - repo: actions/upload-artifact
    category: github-maintained
    purpose: Upload build logs, reports, and scan artifacts

  - repo: actions/download-artifact
    category: github-maintained
    purpose: Retrieve artifacts across jobs/workflows

  - repo: actions/dependency-review-action
    category: github-maintained
    purpose: Dependency review for PRs

  - repo: github/codeql-action
    category: github-maintained
    purpose: CodeQL analysis and SARIF reporting
    notes: Use least privilege; upload SARIF only where required

  # ---------------------------------------------------------------------------
  # CI security hardening
  # ---------------------------------------------------------------------------
  - repo: step-security/harden-runner
    category: security-hardening
    purpose: Runner hardening and egress control
    notes: Prefer restrictive egress policies in security workflows

  # ---------------------------------------------------------------------------
  # Vetted community actions (allowed, but still pinned and governed)
  # ---------------------------------------------------------------------------
  - repo: ossf/scorecard-action
    category: supply-chain
    purpose: OpenSSF Scorecard supply-chain posture scanning

  - repo: trufflesecurity/trufflehog
    category: secrets
    purpose: Secrets scanning (scheduled deep scan)
    notes: Use scheduled scans only; output SARIF to artifacts

  - repo: sonarsource/sonarcloud-github-action
    category: scanning
    purpose: SonarCloud analysis for code quality and security
    notes: >
      Baseline analysis intended non-blocking; risk decision recorded in
      docs/risk-decisions.md#rd-2025-004

validation_notes:
  # Repo format is always "owner/name" with no "@ref" portion.
  repo_format: owner/name

  # Validator expectations:
  # - External uses must match: owner/name@<40-hex-sha>
  # - owner/name must appear in allowlist.repo
  # - Pinning and local action rules are enforced in their own policies
  validator_requirements:
    - ensure_allowlisted_repo_for_external_actions
    - enforce_unique_allowlist_entries
