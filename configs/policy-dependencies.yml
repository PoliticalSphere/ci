# ==============================================================================
# Political Sphere â€” Policy Dependencies Registry
# ==============================================================================
#
# Purpose:
#   Define and document dependencies between all policies and configurations
#   across CI governance, linting, security, and consumer contracts.
#
#   This registry enables:
#   - Automated dependency resolution and validation order
#   - Circular dependency detection during initialization
#   - Clear audit trail of policy relationships
#   - Impact analysis for policy changes
#   - Consumer contract tracking
#
# Format:
#   policy_name:
#     depends_on: [list of policies this depends on]
#     validated_by: [list of validators that check this policy]
#     feeds_into: [list of policies or systems that consume this]
#     tags: [metadata tags for filtering]
#     risk_level: [low|medium|high]
#
# ==============================================================================

# ==============================================================================
# CI Governance Policies
# ==============================================================================

validate-ci:
  description: Core CI validation rules and policy enforcement
  depends_on: 
    - permissions-baseline
    - allowed-actions
    - action-pinning
  validated_by:
    - validate-ci workflow
    - pre-push gate
  feeds_into:
    - GitHub Actions workflows
    - CI platform orchestration
  tags: [core, ci-governance, gating]
  risk_level: high

action-pinning:
  description: SHA-pinning requirements for remote GitHub Actions
  depends_on:
    - allowed-actions
    - naming-policy
  validated_by:
    - validate-ci
    - remote-sha-verify
  feeds_into:
    - validate-ci
    - consumer-contract
  tags: [security, ci-governance, supply-chain]
  risk_level: high

allowed-actions:
  description: Approved GitHub Actions allowlist (default deny)
  depends_on:
    - permissions-baseline
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
    - action-pinning
    - remote-sha-verify
  tags: [security, ci-governance, allowlist]
  risk_level: high

permissions-baseline:
  description: Least-privilege permissions reference for all workflows
  depends_on: []
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
    - allowed-actions
    - high-risk-triggers
  tags: [security, ci-governance, baseline]
  risk_level: high

high-risk-triggers:
  description: High-risk trigger allowlist with safeguards
  depends_on:
    - permissions-baseline
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
    - harden-runner
  tags: [security, ci-governance, triggers]
  risk_level: high

harden-runner:
  description: Runner hardening requirements and allowlist
  depends_on:
    - high-risk-triggers
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
  tags: [security, ci-governance, runner]
  risk_level: medium

inline-bash:
  description: Inline shell constraints and allowlist
  depends_on:
    - permissions-baseline
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
  tags: [security, ci-governance, inline]
  risk_level: high

secrets-handling:
  description: Secrets hygiene and rotation expectations
  depends_on:
    - permissions-baseline
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
  tags: [security, ci-governance, secrets]
  risk_level: high

unsafe-patterns:
  description: Unsafe workflow patterns and remediation guidance
  depends_on:
    - validate-ci
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
    - unsafe-patterns-allowlist
  tags: [security, ci-governance, patterns]
  risk_level: high

unsafe-patterns-allowlist:
  description: Approved exceptions to unsafe patterns with risk decisions
  depends_on:
    - unsafe-patterns
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
  tags: [security, ci-governance, exceptions]
  risk_level: medium

artifact-policy:
  description: Artifact retention and upload policy
  depends_on: []
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
  tags: [operations, ci-governance, artifacts]
  risk_level: low

remote-sha-verify:
  description: Remote SHA verification configuration and defaults
  depends_on:
    - action-pinning
    - allowed-actions
  validated_by:
    - validate-ci
    - remote-verify tests
  feeds_into:
    - validate-ci
  tags: [security, ci-governance, verification]
  risk_level: high

reproducible-installs:
  description: Deterministic dependency installation policy
  depends_on:
    - tooling-versions
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
  tags: [operations, ci-governance, reproducibility]
  risk_level: medium

tooling-versions:
  description: Pinned tooling versions policy (documented)
  depends_on: []
  validated_by:
    - license-check
    - security scans
  feeds_into:
    - reproducible-installs
    - license-policy
    - consumer-contract
  tags: [operations, ci-governance, versions]
  risk_level: medium

logging-policy:
  description: Logging safety policy and standards
  depends_on:
    - secrets-handling
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
  tags: [security, ci-governance, logging]
  risk_level: medium

naming-policy:
  description: Naming conventions for key repository areas
  depends_on: []
  validated_by:
    - linting
    - validate-ci
  feeds_into:
    - validate-ci
    - action-pinning
  tags: [operations, ci-governance, naming]
  risk_level: low

local-actions:
  description: Local action usage constraints and validation
  depends_on:
    - naming-policy
  validated_by:
    - validate-ci
  feeds_into:
    - validate-ci
  tags: [security, ci-governance, actions]
  risk_level: medium

# ==============================================================================
# Lint Configurations
# ==============================================================================

eslint:
  description: ESLint configuration for TypeScript and JavaScript linting
  depends_on:
    - tsconfig
  validated_by:
    - lint workflow
    - pre-commit gate
  feeds_into:
    - consumer-contract
  tags: [quality, lint, code-style]
  risk_level: low

biome:
  description: Biome formatting and correctness rules
  depends_on:
    - eslint
  validated_by:
    - lint workflow
  feeds_into:
    - consumer-contract
  tags: [quality, lint, formatting]
  risk_level: low

yamllint:
  description: YAML validation and formatting rules
  depends_on: []
  validated_by:
    - lint workflow
  feeds_into:
    - validate-ci
  tags: [quality, lint, yaml]
  risk_level: low

actionlint:
  description: GitHub Actions workflow validation
  depends_on:
    - yamllint
  validated_by:
    - lint workflow
  feeds_into:
    - validate-ci
  tags: [quality, lint, actions]
  risk_level: medium

hadolint:
  description: Dockerfile security and quality checks
  depends_on: []
  validated_by:
    - lint workflow
  feeds_into:
    - consumer-contract
  tags: [quality, lint, docker]
  risk_level: low

shellcheck:
  description: Shell script safety and style checks
  depends_on: []
  validated_by:
    - lint workflow
  feeds_into:
    - consumer-contract
  tags: [quality, lint, shell]
  risk_level: low

markdownlint:
  description: Markdown quality and consistency rules
  depends_on: []
  validated_by:
    - lint workflow
  feeds_into:
    - consumer-contract
  tags: [quality, lint, markdown]
  risk_level: low

cspell:
  description: Spell checking configuration
  depends_on: []
  validated_by:
    - lint workflow
  feeds_into:
    - consumer-contract
  tags: [quality, lint, spelling]
  risk_level: low

knip:
  description: Unused dependency detection configuration
  depends_on:
    - tsconfig
  validated_by:
    - lint workflow
  feeds_into:
    - consumer-contract
  tags: [quality, lint, dependencies]
  risk_level: low

jscpd:
  description: Code duplication detection configuration
  depends_on: []
  validated_by:
    - lint workflow
  feeds_into:
    - consumer-contract
  tags: [quality, lint, duplication]
  risk_level: low

tsconfig:
  description: TypeScript compiler configuration and baseline
  depends_on: []
  validated_by:
    - typecheck workflow
  feeds_into:
    - eslint
    - knip
    - consumer-contract
  tags: [quality, lint, typescript]
  risk_level: low

# ==============================================================================
# Security Configurations
# ==============================================================================

gitleaks:
  description: gitleaks secret detection rules and allowlist
  depends_on: []
  validated_by:
    - security gate
  feeds_into:
    - consumer-contract
  tags: [security, secrets, scanning]
  risk_level: high

license-policy:
  description: OSS license compliance allowlist and denylist
  depends_on:
    - tooling-versions
  validated_by:
    - license-check
    - security gate
  feeds_into:
    - consumer-contract
  tags: [compliance, security, licensing]
  risk_level: medium

trivy:
  description: Trivy vulnerability scanning policy and exemptions
  depends_on: []
  validated_by:
    - security gate
  feeds_into:
    - consumer-contract
  tags: [security, scanning, vulnerabilities]
  risk_level: high

# tooling.env (security/tooling.env) is tracked under tooling-versions in CI section

# ==============================================================================
# Consumer Contracts & Verification
# ==============================================================================

consumer-contract:
  description: Consumer contract defining acceptable output and behavior
  depends_on:
    - action-pinning
    - tooling-versions
    - eslint
    - biome
    - hadolint
    - shellcheck
    - markdownlint
    - cspell
    - knip
    - jscpd
    - tsconfig
    - gitleaks
    - license-policy
    - trivy
  validated_by:
    - consumer-contract test
    - contract verification workflow
  feeds_into:
    - customer deliverables
  tags: [contracts, quality, governance]
  risk_level: high

consumer-exceptions:
  description: Approved exceptions to consumer contract terms
  depends_on:
    - consumer-contract
  validated_by:
    - consumer-contract test
  feeds_into:
    - customer deliverables
  tags: [contracts, exceptions, governance]
  risk_level: medium

# ==============================================================================
# Logical Groupings for Batch Operations
# ==============================================================================

# Core security policies (must all pass for security gate)
_security_gate_policies:
  - action-pinning
  - allowed-actions
  - permissions-baseline
  - secrets-handling
  - unsafe-patterns
  - remote-sha-verify

# Core CI policies (must all pass for CI gate)
_ci_gate_policies:
  - validate-ci
  - action-pinning
  - allowed-actions
  - permissions-baseline
  - tooling-versions
  - logging-policy

# All lint policies (must all pass for lint gate)
_lint_policies:
  - eslint
  - biome
  - yamllint
  - actionlint
  - hadolint
  - shellcheck
  - markdownlint
  - cspell
  - knip
  - jscpd
  - tsconfig

# All security scan policies (must all pass for security gate)
_security_scan_policies:
  - gitleaks
  - license-policy
  - trivy

# Policies required for consumer contract validation
_consumer_contract_dependencies:
  - action-pinning
  - tooling-versions
  - eslint
  - biome
  - hadolint
  - shellcheck
  - markdownlint
  - cspell
  - knip
  - jscpd
  - tsconfig
  - gitleaks
  - license-policy
  - trivy
